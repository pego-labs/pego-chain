package misc

import (
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/core/state"
	"github.com/ethereum/go-ethereum/core/systemcontracts"
)

var systemDaoBytecode = "0x608060405234801561001057600080fd5b50600436106101fb5760003560e01c80639087a6881161011a578063ba4d7988116100ad578063d2b4aeb91161007c578063d2b4aeb914610552578063da42cdce1461056f578063e1c7392a14610577578063f9a2bbc714610581578063fe173b9714610589576101fb565b8063ba4d798814610514578063bfc204481461051c578063c0a4d64d14610524578063c5364cad1461054a576101fb565b8063ad7c77db116100e9578063ad7c77db14610497578063b1414fb9146104e7578063b52ee5ee146104ef578063b9242c061461050c576101fb565b80639087a688146104625780639d4cf2331461046a578063a78abc1614610472578063a944dcb61461047a576101fb565b806335475bef11610192578063588187ea11610161578063588187ea146103ba57806361891b80146103e85780636329d76b146104135780638c72761f1461041b576101fb565b806335475bef1461031157806339eb124b1461033f5780633e7975181461035c5780634e51638d1461039d576101fb565b806313ab323f116101ce57806313ab323f1461029e5780631b442278146102a65780631cfe4f0b146102e3578063332daccf146102eb576101fb565b806304db7fe71461020057806306a85e781461021a5780630abf0f5f1461022257806313a1b1fb1461027a575b600080fd5b610208610591565b60408051918252519081900360200190f35b610208610597565b61022a61059c565b60408051602080825283518183015283519192839290830191858101910280838360005b8381101561026657818101518382015260200161024e565b505050509050019250505060405180910390f35b6102826106a7565b604080516001600160a01b039092168252519081900360200190f35b6102826106ad565b6102cf600480360360608110156102bc57600080fd5b50803590602081013590604001356106b3565b604080519115158252519081900360200190f35b61020861084f565b6102cf6004803603602081101561030157600080fd5b50356001600160a01b03166108bd565b6102cf6004803603604081101561032757600080fd5b506001600160a01b03813516906020013515156108f4565b6102cf6004803603602081101561035557600080fd5b50356109ce565b6102cf600480360360e081101561037257600080fd5b5080359060208101359060408101359060608101359060808101359060a08101359060c00135610aad565b6102cf600480360360208110156103b357600080fd5b5035610be4565b6102cf600480360360408110156103d057600080fd5b506001600160a01b0381351690602001351515610c6c565b6103f0610d80565b604080516001600160a01b03909316835260208301919091528051918290030190f35b610208610daa565b6104476004803603604081101561043157600080fd5b506001600160a01b038135169060200135610db0565b60408051921515835260208301919091528051918290030190f35b610208610f55565b610208610f5b565b6102cf610f61565b6102cf6004803603602081101561049057600080fd5b5035610f6a565b6104b4600480360360208110156104ad57600080fd5b503561106e565b604080519687526020870195909552858501939093526060850191909152608084015260a0830152519081900360c00190f35b610282611118565b6102cf6004803603602081101561050557600080fd5b503561111e565b61020861121d565b61020861122b565b610208611231565b61052c611237565b60408051938452602084019290925282820152519081900360600190f35b61028261131a565b6102cf6004803603602081101561056857600080fd5b5035611320565b6102086113a8565b61057f6113ae565b005b6102826114e2565b6102086114e8565b61271081565b600081565b60606110046001600160a01b031663a3b04cf86040518163ffffffff1660e01b815260040160006040518083038186803b1580156105d957600080fd5b505afa1580156105ed573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052602081101561061657600080fd5b810190808051604051939291908464010000000082111561063657600080fd5b90830190602082018581111561064b57600080fd5b825186602082028301116401000000008211171561066857600080fd5b82525081516020918201928201910280838360005b8381101561069557818101518382015260200161067d565b50505050905001604052505050905090565b61100481565b61100381565b600033611001146106f55760405162461bcd60e51b815260040180806020018281038252602e815260200180611550602e913960400191505060405180910390fd5b60006110006001600160a01b03166387eb31f485856040518363ffffffff1660e01b81526004018083815260200182815260200192505050602060405180830381600087803b15801561074757600080fd5b505af115801561075b573d6000803e3d6000fd5b505050506040513d602081101561077157600080fd5b5051604080516396cf522760e01b8152600481018890529051919250600091611004916396cf522791602480830192602092919082900301818787803b1580156107ba57600080fd5b505af11580156107ce573d6000803e3d6000fd5b505050506040513d60208110156107e457600080fd5b505190508180156107f25750805b610843576040805162461bcd60e51b815260206004820152601f60248201527f63616c6c204956616c696461746f72206f72204950475654206661696c656400604482015290519081900360640190fd5b50600195945050505050565b60006110006001600160a01b0316631cfe4f0b6040518163ffffffff1660e01b815260040160206040518083038186803b15801561088c57600080fd5b505afa1580156108a0573d6000803e3d6000fd5b505050506040513d60208110156108b657600080fd5b5051905090565b6001600160a01b03811660009081526004602052604081205460018114156108e95760019150506108ef565b60009150505b919050565b600033611001146109365760405162461bcd60e51b815260040180806020018281038252602e815260200180611550602e913960400191505060405180910390fd5b8115610983576001600160a01b03831660008181526004602052604080822060019055517fc0b5ecd2457ee51ce2eed5ad8aa0ae13bfdf5e76669fc4a8d1b38a663f5821dc9190a26109c5565b6001600160a01b038316600081815260046020526040808220829055517f911710ae478ae660edff3617598a5d9c080273f94dfb409a2088a3b741a82f6e9190a25b50600192915050565b60003361100114610a105760405162461bcd60e51b815260040180806020018281038252602e815260200180611550602e913960400191505060405180910390fd5b6103e88210158015610a2457506127108211155b610a67576040805162461bcd60e51b815260206004820152600f60248201526e1a5b9d985b1a59081c195c98d95b9d608a1b604482015290519081900360640190fd5b600354604080519182526020820184905280517f5ad6994a655a5e893737683c9d77060b782cf664c6acff8ffbbc558ace9aed8c9281900390910190a150600355600190565b60003361100114610aef5760405162461bcd60e51b815260040180806020018281038252602e815260200180611550602e913960400191505060405180910390fd5b6040805163b53e350960e01b8152600481018a90526024810189905260448101889052606481018790526084810186905260a4810185905260c4810184905290516000916110019163b53e35099160e48082019260209290919082900301818787803b158015610b5e57600080fd5b505af1158015610b72573d6000803e3d6000fd5b505050506040513d6020811015610b8857600080fd5b5051905080610bd5576040805162461bcd60e51b815260206004820152601460248201527318d85b1b0811dbdd995c9b9bdc8819985a5b195960621b604482015290519081900360640190fd5b50600198975050505050505050565b60003361100114610c265760405162461bcd60e51b815260040180806020018281038252602e815260200180611550602e913960400191505060405180910390fd5b600154604080519182526020820184905280517f0134b21fc974c2377a5ee7f02e1b36118e638f2e920ea156f88241455b74715b9281900390910190a150600190815590565b60003361100114610cae5760405162461bcd60e51b815260040180806020018281038252602e815260200180611550602e913960400191505060405180910390fd5b6040805163153bd00f60e01b81526001600160a01b0385166004820152831515602482015290516000916110049163153bd00f9160448082019260209290919082900301818787803b158015610d0357600080fd5b505af1158015610d17573d6000803e3d6000fd5b505050506040513d6020811015610d2d57600080fd5b5051905080610d76576040805162461bcd60e51b815260206004820152601060248201526f18d85b1b081c19dd9d0819985a5b195960821b604482015290519081900360640190fd5b5060019392505050565b436000908152600660209081526040808320546007909252909120546001600160a01b0390911691565b60015490565b6000803361100114610df35760405162461bcd60e51b815260040180806020018281038252602e815260200180611550602e913960400191505060405180910390fd5b600083118015610e0d575069152d02c7e14af68000008311155b610e4f576040805162461bcd60e51b815260206004820152600e60248201526d1a5b9d985b1a5908185b5bdd5b9d60921b604482015290519081900360640190fd5b6001600160a01b038416610e9e576040805162461bcd60e51b81526020600482015260116024820152701a5b9d985b1a59081c9958da5c1a595b9d607a1b604482015290519081900360640190fd5b6000610eac436102586114ee565b90505b6000818152600660205260409020546001600160a01b031615610ed457600101610eaf565b600081815260066020908152604080832080546001600160a01b038a166001600160a01b0319909116811790915560078352928190208790558051928352908201869052818101839052517ff9a4dba4d5a66c39001db55ec87d12d5cdb29f52b83b2f1d5a7038c4bdf359e49181900360600190a160019590945092505050565b6103e881565b60025490565b60005460ff1681565b60003361100114610fac5760405162461bcd60e51b815260040180806020018281038252602e815260200180611550602e913960400191505060405180910390fd5b60006110006001600160a01b031663a944dcb6846040518263ffffffff1660e01b815260040180828152602001915050602060405180830381600087803b158015610ff657600080fd5b505af115801561100a573d6000803e3d6000fd5b505050506040513d602081101561102057600080fd5b50519050806109c5576040805162461bcd60e51b815260206004820152601560248201527418d85b1b0815985b1a59185d1bdc8819985a5b1959605a1b604482015290519081900360640190fd5b6000806000806000806110016001600160a01b031663ad7c77db886040518263ffffffff1660e01b81526004018082815260200191505060c06040518083038186803b1580156110bd57600080fd5b505afa1580156110d1573d6000803e3d6000fd5b505050506040513d60c08110156110e757600080fd5b508051602082015160408301516060840151608085015160a090950151939c929b5090995097509195509350915050565b61100281565b600033611001146111605760405162461bcd60e51b815260040180806020018281038252602e815260200180611550602e913960400191505060405180910390fd5b60006110046001600160a01b031663b52ee5ee846040518263ffffffff1660e01b815260040180828152602001915050602060405180830381600087803b1580156111aa57600080fd5b505af11580156111be573d6000803e3d6000fd5b505050506040513d60208110156111d457600080fd5b50519050806109c5576040805162461bcd60e51b815260206004820152601060248201526f18d85b1b081c19dd9d0819985a5b195960821b604482015290519081900360640190fd5b69152d02c7e14af680000081565b60035481565b60035490565b60008060006110046001600160a01b031663c0a4d64d6040518163ffffffff1660e01b815260040160206040518083038186803b15801561127757600080fd5b505afa15801561128b573d6000803e3d6000fd5b505050506040513d60208110156112a157600080fd5b50516040805163c0a4d64d60e01b815281519295506110009263c0a4d64d92600480840193919291829003018186803b1580156112dd57600080fd5b505afa1580156112f1573d6000803e3d6000fd5b505050506040513d604081101561130757600080fd5b5080516020909101519394909392509050565b61100181565b600033611001146113625760405162461bcd60e51b815260040180806020018281038252602e815260200180611550602e913960400191505060405180910390fd5b600254604080519182526020820184905280517fd26e795f46aa88ea5c50cae0b7e3d41237d1a275bb6aff0042d11193e13804759281900390910190a150600255600190565b60025481565b60005460ff1615611406576040805162461bcd60e51b815260206004820152601960248201527f74686520636f6e747261637420616c726561647920696e697400000000000000604482015290519081900360640190fd5b6000600281905560408051828152602081019290925280517fd26e795f46aa88ea5c50cae0b7e3d41237d1a275bb6aff0042d11193e13804759281900390910190a164746a52880060018190556040805160008152602081019290925280517f0134b21fc974c2377a5ee7f02e1b36118e638f2e920ea156f88241455b74715b9281900390910190a1611f4060038190556040805160008152602081019290925280517f5ad6994a655a5e893737683c9d77060b782cf664c6acff8ffbbc558ace9aed8c9281900390910190a16000805460ff19166001179055565b61100081565b60015481565b600082820183811015611548576040805162461bcd60e51b815260206004820152601b60248201527f536166654d6174683a206164646974696f6e206f766572666c6f770000000000604482015290519081900360640190fd5b939250505056fe746865206d6573736167652073656e646572206d75737420626520676f7665726e616e636520636f6e7472616374a26469706673582212202715a533a06aa6a78a68dc97e9e1df5a82d1570443f02a3a9f5dd534b79370ab64736f6c63430007060033"

// ApplySystemDaoUpgrade modifies the state database according to SystemDao contract Upgrade.
func ApplySystemDaoUpgrade(statedb *state.StateDB) {
	code := common.FromHex(string(systemDaoBytecode))
	statedb.SetCode(common.HexToAddress(systemcontracts.SystemDaoContract), code)
}
